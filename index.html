<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="judo.png">
    <link rel="manifest" href="manifest.json">
    <title>–°–∞–º–±–æ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 50%, #2d2d54 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 2.8em;
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .header p {
            color: #a0a0a0;
            font-size: 16px;
            font-weight: 300;
        }

        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
        }

        .service-buttons {
            display: flex;
            gap: 16px
        }

        .service-buttons > .nav-btn {
            background: #3b3d41;
        }

        .nav-btn {
            background: linear-gradient(135deg, #6c7b95, #5a6c7d);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(108, 123, 149, 0.2);
            flex: 1;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-btn_add-new {
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(108, 123, 149, 0.3);
        }

        .nav-btn:active {
            transform: translateY(0);
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .filter-title {
            color: #ff6b6b;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #ffffff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 400;
            backdrop-filter: blur(5px);
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .filter-btn.active {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.2);
            width: 100%;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 14px;
            width: auto;
            margin: 0;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff5252, #f44336);
        }

        .btn-success {
            opacity: 0.25;
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c7b95, #5a6c7d);
        }

        .students-list {
            margin-top: 20px;
        }

        .student-item {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .student-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ff6b6b, transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .student-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }

        .student-item:hover::before {
            opacity: 1;
        }

        .student-item.priority-high {
            border-left: 4px solid #ff5252;
            background: linear-gradient(135deg, rgba(255, 82, 82, 0.1), rgba(255, 255, 255, 0.05));
        }

        .student-item.priority-medium {
            border-left: 4px solid #ff9800;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 255, 255, 0.05));
        }

        .student-item.priority-low {
            border-left: 4px solid #2196f3;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(255, 255, 255, 0.05));
        }

        .student-item.priority-ok {
            border-left: 4px solid #4caf50;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(255, 255, 255, 0.05));
        }

        .student-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .student-info {
            font-size: 14px;
            color: #a0a0a0;
            font-weight: 400;
        }

        .training-count {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 107, 107, 0.2);
            backdrop-filter: blur(10px);
            color: #ff6b6b;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 100%);
            margin: 50px auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .close {
            color: #a0a0a0;
            float: right;
            font-size: 24px;
            font-weight: normal;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ff6b6b;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ff6b6b;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .student-detail {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .student-detail h2 {
            color: #ff6b6b;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 400;
            font-size: 24px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-item label {
            display: block;
            color: #a0a0a0;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-item .value {
            color: #ffffff;
            font-weight: 600;
            font-size: 16px;
        }

        .training-list {
            margin-top: 20px;
        }

        .training-list h3 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-weight: 400;
            font-size: 18px;
        }

        .training-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 3px solid #ff6b6b;
            backdrop-filter: blur(5px);
        }

        .training-date {
            font-weight: 600;
            color: #ff6b6b;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .training-number {
            font-size: 12px;
            color: #a0a0a0;
            margin-bottom: 8px;
        }

        .training-description {
            color: #ffffff;
            font-size: 14px;
            line-height: 1.4;
        }

        .back-btn {
            background: linear-gradient(135deg, #6c7b95, #5a6c7d);
            margin-bottom: 20px;
        }

        .button-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 25px;
        }

        .button-row .btn {
            flex: 1;
            margin: 0;
        }

        .hidden {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0a0a0;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #ff6b6b;
            font-weight: 400;
            font-size: 20px;
        }

        .empty-state p {
            font-size: 14px;
            opacity: 0.7;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .student-item {
            animation: fadeIn 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .button-row {
                flex-direction: column;
            }
            
            .filter-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div id="main-page">
            <div class="header">
                <h1>ü•ã –°–ê–ú–ë–û</h1>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏</p>
            </div>

            <div class="nav-buttons">
                <div class="service-buttons">
                    <button class="nav-btn" onclick="exportData()">
                        üì§ –≠–∫—Å–ø–æ—Ä—Ç
                    </button>
                    <button class="nav-btn" onclick="importData()">
                        üì• –ò–º–ø–æ—Ä—Ç
                    </button>
                </div>
                <a href="./schedule_app.html" class="nav-btn">
                    üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                </a>
                <button class="nav-btn nav-btn_add-new" onclick="openAddStudentModal()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞
                </button>
            </div>

            <div class="filter-section">
                <div class="filter-title">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="setFilter('default')">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
                    <button class="filter-btn" onclick="setFilter('trainings-asc')">–ü–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º ‚Üë</button>
                    <button class="filter-btn" onclick="setFilter('trainings-desc')">–ü–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º ‚Üì</button>
                </div>
            </div>

            <div class="students-list">
                <div id="students-container">
                    <div class="empty-state">
                        <h3>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—á–µ–Ω–∏–∫–∞ -->
        <div id="student-page" class="hidden">
            <button class="btn back-btn" onclick="showMainPage()">
                ‚Üê –ù–∞–∑–∞–¥
            </button>

            <div class="student-detail">
                <h2 id="student-name-detail"></h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã</label>
                        <div class="value" id="student-payment-detail"></div>
                    </div>
                    <div class="info-item">
                        <label>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã</label>
                        <div class="value" id="student-date-detail"></div>
                    </div>
                    <div class="info-item">
                        <label>–û—Å—Ç–∞–ª–æ—Å—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</label>
                        <div class="value" id="student-trainings-detail"></div>
                    </div>
                </div>

                <div class="button-row">
                    <button class="btn btn-success btn-small" onclick="openAttendanceModal()" disabled>
                        ‚úì –ü–æ—Å–µ—â–µ–Ω–∏–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –æ—Ç–º–µ—á–∞–π—Ç–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ)
                    </button>
                    <button class="btn btn-warning btn-small" onclick="openPaymentModal()">
                        üí∞ –û–ø–ª–∞—Ç–∞
                    </button>
                    <button class="btn btn-danger btn-small" onclick="deleteStudent()">
                        üóë –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>

            <div class="training-list">
                <h3>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h3>
                <div id="trainings-container">
                    <div class="empty-state">
                        <p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <!-- –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞ -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addStudentModal')">&times;</span>
            <h2 style="color: #ff6b6b; margin-bottom: 20px; font-weight: 400;">–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h2>
            <form id="addStudentForm">
                <div class="form-group">
                    <label>–§–∞–º–∏–ª–∏—è –∏ –∏–º—è</label>
                    <input type="text" id="studentName" required>
                </div>
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</label>
                    <input type="number" id="trainingCount" min="1" required>
                </div>
                <div class="form-group">
                    <label>–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã</label>
                    <input type="number" id="paymentAmount" min="0" required>
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã</label>
                    <input type="date" id="paymentDate" required>
                </div>
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏–µ -->
    <div id="attendanceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('attendanceModal')">&times;</span>
            <h2 style="color: #ff6b6b; margin-bottom: 20px; font-weight: 400;">–û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏–µ</h2>
            <form id="attendanceForm">
                <div class="form-group">
                    <label>–î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
                    <input type="date" id="attendanceDate" required>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="attendanceDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏">
                </div>
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–∏—Ç—å –æ–ø–ª–∞—Ç—É -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            <h2 style="color: #ff6b6b; margin-bottom: 20px; font-weight: 400;">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–ª–∞—Ç—É</h2>
            <form id="paymentForm">
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</label>
                    <input type="number" id="newTrainingCount" min="1" required>
                </div>
                <div class="form-group">
                    <label>–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã</label>
                    <input type="number" id="newPaymentAmount" min="0" required>
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã</label>
                    <input type="date" id="newPaymentDate" required>
                </div>
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('deleteModal')">&times;</span>
            <h2 style="color: #ff6b6b; margin-bottom: 20px; font-weight: 400;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h2>
            <p style="margin-bottom: 20px; text-align: center;">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞?</p>
            <p style="margin-bottom: 30px; text-align: center; color: #ff9800;">–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ –ø–æ—Ç–µ—Ä—è–Ω—ã!</p>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-danger" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeModal('deleteModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let students = [];
        let currentStudentId = null;
        let currentFilter = 'default';

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            loadStudents();
            setDefaultDate();
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
        function saveStudents() {
            const studentsData = JSON.stringify(students);
            localStorage.setItem('sambo_students', studentsData);
        }

        function loadStudents() {
            const studentsData = localStorage.getItem('sambo_students');
            if (studentsData) {
                students = JSON.parse(studentsData);
            }
            renderStudents();
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('paymentDate').value = today;
            document.getElementById('attendanceDate').value = today;
            document.getElementById('newPaymentDate').value = today;
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        function setFilter(filterType) {
            currentFilter = filterType;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderStudents();
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        function sortStudents(students) {
            switch(currentFilter) {
                case 'trainings-asc':
                    return [...students].sort((a, b) => a.trainingsLeft - b.trainingsLeft);
                case 'trainings-desc':
                    return [...students].sort((a, b) => b.trainingsLeft - a.trainingsLeft);
                default:
                    return [...students].sort((a, b) => a.id - b.id);
            }
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤
        function renderStudents() {
            const container = document.getElementById('students-container');
            
            if (students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</p>
                    </div>
                `;
                return;
            }

            const sortedStudents = sortStudents(students);
            
            container.innerHTML = sortedStudents.map(student => {
                const priorityClass = getPriorityClass(student.trainingsLeft);
                return `
                    <div class="student-item ${priorityClass}" onclick="showStudentDetail(${student.id})">
                        <div class="student-name">${student.name}</div>
                        <div class="student-info">
                            –û–ø–ª–∞—á–µ–Ω–æ: ${student.paymentAmount}‚ÇΩ ‚Ä¢ ${formatDate(student.paymentDate)}
                        </div>
                        <div class="training-count">${student.trainingsLeft}</div>
                    </div>
                `;
            }).join('');
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–æ —Ü–≤–µ—Ç—É
        function getPriorityClass(trainingsLeft) {
            if (trainingsLeft === 0) return 'priority-high';
            if (trainingsLeft === 1) return 'priority-medium';
            if (trainingsLeft === 2) return 'priority-low';
            else return 'priority-ok'
            return '';
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            const convertedDate = date.toLocaleDateString('ru-RU');

            return convertedDate === 'Invalid Date' ? dateString : convertedDate;
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openAddStudentModal() {
            document.getElementById('addStudentModal').style.display = 'block';
        }

        function openAttendanceModal() {
            document.getElementById('attendanceModal').style.display = 'block';
        }

        function openPaymentModal() {
            document.getElementById('paymentModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º
        document.getElementById('addStudentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const student = {
                id: Date.now(),
                name: document.getElementById('studentName').value,
                trainingsLeft: parseInt(document.getElementById('trainingCount').value),
                paymentAmount: parseInt(document.getElementById('paymentAmount').value),
                paymentDate: document.getElementById('paymentDate').value,
                trainings: []
            };

            students.push(student);
            saveStudents();
            renderStudents();
            closeModal('addStudentModal');
            this.reset();
            setDefaultDate();
        });

        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const student = students.find(s => s.id === currentStudentId);
            if (student && student.trainingsLeft > 0) {
                const training = {
                    id: Date.now(),
                    date: document.getElementById('attendanceDate').value,
                    description: document.getElementById('attendanceDescription').value || '',
                    number: student.trainings.length + 1
                };

                student.trainings.unshift(training);
                student.trainingsLeft--;
                
                saveStudents();
                renderStudents();
                showStudentDetail(currentStudentId);
                closeModal('attendanceModal');
                this.reset();
                setDefaultDate();
            }
        });

        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const student = students.find(s => s.id === currentStudentId);
            if (student) {
                student.trainingsLeft += parseInt(document.getElementById('newTrainingCount').value);
                student.paymentAmount = parseInt(document.getElementById('newPaymentAmount').value);
                student.paymentDate = document.getElementById('newPaymentDate').value;
                student.trainings = [];
                
                saveStudents();
                renderStudents();
                showStudentDetail(currentStudentId);
                closeModal('paymentModal');
                this.reset();
                setDefaultDate();
            }
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
        function showMainPage() {
            document.getElementById('main-page').classList.remove('hidden');
            document.getElementById('student-page').classList.add('hidden');
        }

        function showStudentDetail(studentId) {
            currentStudentId = studentId;
            const student = students.find(s => s.id === studentId);
            
            if (!student) return;

            document.getElementById('student-name-detail').textContent = student.name;
            document.getElementById('student-payment-detail').textContent = student.paymentAmount + '‚ÇΩ';
            document.getElementById('student-date-detail').textContent = formatDate(student.paymentDate);
            document.getElementById('student-trainings-detail').textContent = student.trainingsLeft;

            renderTrainings(student.trainings);

            document.getElementById('main-page').classList.add('hidden');
            document.getElementById('student-page').classList.remove('hidden');
        }

        // –†–µ–Ω–¥–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
        function renderTrainings(trainings) {
            const container = document.getElementById('trainings-container');
            
            if (trainings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = trainings.map(training => `
                <div class="training-item">
                    <div class="training-date">${formatDate(training.date)}</div>
                    <div class="training-number">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ #${training.number}</div>
                    ${training.description ? `<div class="training-description">${training.description}</div>` : ''}
                </div>
            `).join('');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞
        function deleteStudent() {
            document.getElementById('deleteModal').style.display = 'block';
        }

        function confirmDelete() {
            students = students.filter(s => s.id !== currentStudentId);
            saveStudents();
            renderStudents();
            closeModal('deleteModal');
            showMainPage();
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };



        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å IndexedDB
        function openIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('SamboScheduleDB', 1)
                
                request.onerror = () => reject(request.error);
                
                request.onsuccess = () => {
                    const db = request.result;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â
                    const hasSchedule = db.objectStoreNames.contains('schedule');
                    const hasTimeSlots = db.objectStoreNames.contains('timeSlots');
                    
                    if (!hasSchedule || !hasTimeSlots) {
                        // –ï—Å–ª–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –±–∞–∑—É –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
                        db.close();
                        
                        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                        const deleteRequest = indexedDB.deleteDatabase('SamboScheduleDB');
                        deleteRequest.onsuccess = () => {
                            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                            const newRequest = indexedDB.open('SamboScheduleDB', 1);
                            
                            newRequest.onerror = () => reject(newRequest.error);
                            newRequest.onsuccess = () => resolve(newRequest.result);
                            
                            newRequest.onupgradeneeded = (event) => {
                                const newDb = event.target.result;
                                
                                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
                                if (!newDb.objectStoreNames.contains('schedule')) {
                                    newDb.createObjectStore('schedule', { keyPath: 'id', autoIncrement: true });
                                }
                                
                                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
                                if (!newDb.objectStoreNames.contains('timeSlots')) {
                                    newDb.createObjectStore('timeSlots', { keyPath: 'id', autoIncrement: true });
                                }
                            };
                        };
                        
                        deleteRequest.onerror = () => reject(deleteRequest.error);
                    } else {
                        resolve(db);
                    }
                };
                
                // –°–æ–∑–¥–∞–µ–º —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    if (!db.objectStoreNames.contains('schedule')) {
                        db.createObjectStore('schedule', { keyPath: 'id', autoIncrement: true });
                    }
                    
                    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    if (!db.objectStoreNames.contains('timeSlots')) {
                        db.createObjectStore('timeSlots', { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        function getIndexedDBData(db, storeName) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
            });
        }

        function setIndexedDBData(db, storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                const clearRequest = store.clear();
                
                clearRequest.onsuccess = () => {
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    data.forEach(item => {
                        store.add(item);
                    });
                };
                
                transaction.oncomplete = () => resolve();
                transaction.onerror = () => reject(transaction.error);
            });
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        async function exportData() {
            try {
                const exportData = {
                    students: students,
                    schedule: [],
                    timeSlots: []
                };

                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ IndexedDB
                try {
                    const db = await openIndexedDB();
                    exportData.schedule = await getIndexedDBData(db, 'schedule');
                    exportData.timeSlots = await getIndexedDBData(db, 'timeSlots');
                    db.close();
                } catch (error) {
                    console.log('IndexedDB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –ø—É—Å—Ç–∞:', error);
                }

                // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `sambo_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(link.href);
                
                alert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function importData() {
            document.getElementById('importFile').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
                    if (!importData.students || !Array.isArray(importData.students)) {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞');
                    }

                    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞
                    const confirmImport = confirm(
                        '–í–Ω–∏–º–∞–Ω–∏–µ! –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ.\n' +
                        '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?'
                    );
                    
                    if (!confirmImport) return;

                    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                    students = importData.students;
                    saveStudents();
                    renderStudents();

                    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ IndexedDB
                    if (importData.schedule || importData.timeSlots) {
                        try {
                            const db = await openIndexedDB();
                            
                            if (importData.schedule && Array.isArray(importData.schedule)) {
                                await setIndexedDBData(db, 'schedule', importData.schedule);
                            }
                            
                            if (importData.timeSlots && Array.isArray(importData.timeSlots)) {
                                await setIndexedDBData(db, 'timeSlots', importData.timeSlots);
                            }
                            
                            db.close();
                        } catch (error) {
                            console.log('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –≤ IndexedDB:', error);
                        }
                    }

                    alert('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö.');
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // –û—á–∏—â–∞–µ–º input
        }
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.error('Service Worker registration failed:', err));
        }
    </script>
</body>
</html>
